<!DOCTYPE html>
<!--
 *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
-->
<html>
<head>
  <!-- Change the title tag to your app's name to display as the details text on the Cast device picker -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chromecast mirror</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
  <!--<script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/mediaplayer/1.0.0/media_player.js"></script>-->
</head>
<body>
  <body style="margin: 0">
    <div id="container">
      <video id="remoteVideo" preload="metadata"></video>
    </div>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <script src="js/main.js"></script>
  <script>
    window.mediaElement = document.getElementById('remoteVideo');
    window.mediaManager = new cast.receiver.MediaManager(window.mediaElement);
    window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
    window.castReceiverManager.start();

    window.castReceiverManager.onSenderDisconnected = function(event) {
      console.log(event);
    if(window.castReceiverManager.getSenders().length == 0 &&
      event.reason == cast.receiver.system.DisconnectReason.REQUESTED_BY_SENDER) {
        window.close();
      }
    }
    window.mediaElement.getElementById('remoteVideo').addEventListener('loadedmetadata', function() {
      if (video.buffered.length === 0) return;

      var bufferedSeconds = video.buffered.end(0) - video.buffered.start(0);
      console.log(bufferedSeconds + ' seconds of video are ready to play!');
    });
  </script>
</body>
</html>
